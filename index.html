<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Leafy Library - necotastudio</title>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            --primary-green: #4CAF50;
            --dark-green: #2E7D32;
            --wood-brown: #5D4037;
            --paper-white: #F5F5DC;
            --rakuten-red: #BF0000;
        }

        body {
            font-family: 'Zen Maru Gothic', sans-serif;
            background-color: var(--paper-white);
            color: var(--wood-brown);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-bottom: 100px;
        }

        header {
            background-color: var(--primary-green);
            color: white;
            width: 100%;
            padding: 30px 0;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .header-logo {
            width: 80px; height: 80px; border-radius: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            margin-bottom: 10px; background: white;
            object-fit: cover;
        }

        .stats { font-size: 1.5rem; margin: 15px 0; font-weight: 900; }

        .bookshelf {
            width: 90%; max-width: 500px; background-color: var(--wood-brown);
            padding: 20px 15px; border-radius: 8px; margin: 20px 0;
            min-height: 120px; display: flex; flex-wrap: wrap; gap: 8px;
            align-content: flex-start; border-bottom: 12px solid #3e2723;
            box-shadow: inset 0 -10px 20px rgba(0,0,0,0.4);
        }

        .book {
            width: 22px; height: 80px; border-left: 3px solid rgba(255,255,255,0.2);
            border-radius: 3px; cursor: pointer; transition: all 0.2s ease;
        }
        .book:hover { transform: translateY(-15px); box-shadow: 5px 15px 20px rgba(0,0,0,0.4); }

        #display-panel {
            width: 85%; max-width: 480px; background: white; padding: 20px;
            border-radius: 20px; border: 3px solid var(--primary-green);
            margin: 15px 0; text-align: center; display: none; animation: fadeIn 0.3s ease-out;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .controls { 
            width: 90%; max-width: 500px; background: #fff; padding: 20px; 
            border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
            box-sizing: border-box; 
        }

        .mode-selector {
            display: flex; gap: 10px; margin-bottom: 15px;
        }
        .btn-mode {
            flex: 1; padding: 10px; border-radius: 10px; border: 2px solid var(--primary-green);
            background: white; color: var(--primary-green); font-weight: bold; cursor: pointer;
        }
        .btn-mode.active {
            background: var(--primary-green); color: white;
        }

        label { font-size: 0.8rem; font-weight: bold; color: var(--dark-green); display: block; margin-top: 10px; text-align: left; }
        select, button { padding: 12px; margin: 8px 0; border-radius: 12px; border: 1px solid #ccc; font-size: 16px; width: 100%; box-sizing: border-box; font-family: 'Zen Maru Gothic', sans-serif; }
        
        .btn-eat { background-color: var(--primary-green); color: white; border: none; cursor: pointer; font-weight: 900; box-shadow: 0 4px 0 var(--dark-green); margin-top: 15px; }
        .btn-eat:active { transform: translateY(2px); box-shadow: 0 2px 0 var(--dark-green); }

        .sns-buttons { margin-top: 15px; display: flex; justify-content: center; gap: 10px; }
        .btn-sns { padding: 10px 20px; border-radius: 25px; border: none; color: white; text-decoration: none; font-weight: bold; font-size: 0.8rem; }
        .btn-x { background-color: #000; }
        .btn-insta { background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888); }

        .affiliate-box { margin-top: 15px; padding: 12px; border: 2px solid var(--rakuten-red); background-color: #fff5f5; border-radius: 12px; }
        .affiliate-link { color: var(--rakuten-red); font-weight: bold; text-decoration: none; font-size: 0.9rem; }

        @keyframes fadeIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body>

<header>
    <img src="hamono.png" alt="Leafy Library ãƒ­ã‚´" class="header-logo" onerror="this.style.display='none';">
    <h1 style="margin:0;">Leafy Library</h1>
    <small>LL - ä¸–ç•Œã®è‘‰ç‰©é‡èœç›®éŒ² by necotastudio</small>
</header>

<div class="stats">ç·è‘‰ã£ã±æ•°: <span id="leaf-count">0</span> æš</div>

<div class="bookshelf" id="shelf"></div>

<div id="display-panel">
    <div id="panel-content"></div>
    <div class="sns-buttons">
        <a id="share-x" class="btn-sns btn-x" target="_blank"><i class="fa-brands fa-x-twitter"></i> Xã§å ±å‘Š</a>
        <a href="https://www.instagram.com/necotastudio" target="_blank" class="btn-sns btn-insta"><i class="fa-brands fa-instagram"></i> Insta</a>
    </div>
</div>

<div class="controls">
    <div class="mode-selector">
        <button id="mode-veg" class="btn-mode active" onclick="switchMode('veg')">ğŸ¥¬ é‡èœã‹ã‚‰æ¢ã™</button>
        <button id="mode-dish" class="btn-mode" onclick="switchMode('dish')">ğŸ³ æ–™ç†ã‹ã‚‰æ¢ã™</button>
    </div>

    <div id="veg-ui">
        <label>â‘  é‡èœã®åˆ†é¡</label>
        <select id="veg-cat" onchange="updateVegList()">
            <option value="å®šç•ª">å®šç•ªï¼ˆã‚­ãƒ£ãƒ™ãƒ„ãƒ»ãƒ¬ã‚¿ã‚¹ç­‰ï¼‰</option>
            <option value="å’Œã®è‘‰">å’Œã®è‘‰ï¼ˆã»ã†ã‚Œã‚“è‰ãƒ»æ˜¥èŠç­‰ï¼‰</option>
            <option value="ä¸­è¯ãƒ»ã‚¢ã‚¸ã‚¢">ä¸­è¯ãƒ»ã‚¢ã‚¸ã‚¢ï¼ˆç©ºèŠ¯èœç­‰ï¼‰</option>
            <option value="æ´‹ã®è‘‰">è¥¿æ´‹ãƒ»ã‚µãƒ©ãƒ€èœï¼ˆã‚±ãƒ¼ãƒ«ç­‰ï¼‰</option>
            <option value="ãƒãƒ¼ãƒ–ãƒ»è–¬è‰">ãƒãƒ¼ãƒ–ãƒ»è–¬è‰ï¼ˆãƒ‘ã‚¯ãƒãƒ¼ç­‰ï¼‰</option>
            <option value="é‡è‰ãƒ»å±±èœ">é‡è‰ãƒ»å±±èœï¼ˆã‚ã—ãŸã°ç­‰ï¼‰</option>
        </select>
        <label>â‘¡ å…·ä½“çš„ãªé‡èœå</label>
        <select id="veg-list"></select>
    </div>

    <div id="dish-ui" style="display:none;">
        <label>â‘  æ–™ç†ã®ã‚¸ãƒ£ãƒ³ãƒ«</label>
        <select id="dish-cat" onchange="updateDishList()">
            <option value="ç”Ÿãƒ»ã‚µãƒ©ãƒ€">ç”Ÿé£Ÿãƒ»ã‚µãƒ©ãƒ€</option>
            <option value="ç„¼ãƒ»ç‚’">ç„¼ããƒ»ç‚’ã‚ç‰©</option>
            <option value="ç…®ãƒ»è’¸">ç…®è¾¼ã¿ãƒ»è’¸ã—æ–™ç†</option>
            <option value="é£²ãƒ»æ±">é£²ã¿ç‰©ãƒ»ã‚¹ãƒ¼ãƒ—</option>
        </select>
        <label>â‘¡ å…·ä½“çš„ãªãƒ¡ãƒ‹ãƒ¥ãƒ¼</label>
        <select id="dish-list"></select>
    </div>

    <button class="btn-eat" onclick="recordLeaf()">ã“ã®è‘‰ã£ã±ã‚’è”µæ›¸ã«åŠ ãˆã‚‹</button>
</div>

<script>
    let totalLeaves = 0;
    let unlockedIds = new Set();
    let currentMode = 'veg';
    const rakutenBase = "https://hb.afl.rakuten.co.jp/hgc/38bc4499.7d06e22c.38bc449a.2e400495/?pc=https%3A%2F%2Fsearch.rakuten.co.jp%2Fsearch%2Fmall%2F";

    // --- é‡èœãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ ---
    const vegMaster = [
        {cat: "å®šç•ª", name: "ã‚­ãƒ£ãƒ™ãƒ„", count: 3, kw: "ã‚­ãƒ£ãƒ™ãƒ„"},
        {cat: "å®šç•ª", name: "ãƒ¬ã‚¿ã‚¹ï¼ˆç‰ãƒ»ã‚µãƒ‹ãƒ¼ï¼‰", count: 3, kw: "ãƒ¬ã‚¿ã‚¹"},
        {cat: "å®šç•ª", name: "ç™½èœ", count: 4, kw: "ç™½èœ"},
        {cat: "å’Œã®è‘‰", name: "ã»ã†ã‚Œã‚“è‰", count: 5, kw: "ã»ã†ã‚Œã‚“è‰"},
        {cat: "å’Œã®è‘‰", name: "å°æ¾èœ", count: 5, kw: "å°æ¾èœ"},
        {cat: "å’Œã®è‘‰", name: "æ˜¥èŠ", count: 4, kw: "æ˜¥èŠ"},
        {cat: "å’Œã®è‘‰", name: "å¤§è‘‰ï¼ˆã—ãï¼‰", count: 2, kw: "å¤§è‘‰"},
        {cat: "å’Œã®è‘‰", name: "æ°´èœ", count: 3, kw: "æ°´èœ"},
        {cat: "ä¸­è¯ãƒ»ã‚¢ã‚¸ã‚¢", name: "ãƒãƒ³ã‚²ãƒ³èœ", count: 5, kw: "ãƒãƒ³ã‚²ãƒ³èœ"},
        {cat: "ä¸­è¯ãƒ»ã‚¢ã‚¸ã‚¢", name: "ç©ºèŠ¯èœ", count: 6, kw: "ç©ºèŠ¯èœ"},
        {cat: "ä¸­è¯ãƒ»ã‚¢ã‚¸ã‚¢", name: "ãƒ‹ãƒ©", count: 3, kw: "ãƒ‹ãƒ©"},
        {cat: "æ´‹ã®è‘‰", name: "ã‚±ãƒ¼ãƒ«", count: 8, kw: "ã‚±ãƒ¼ãƒ«"},
        {cat: "æ´‹ã®è‘‰", name: "ãƒ«ãƒƒã‚³ãƒ©", count: 5, kw: "ãƒ«ãƒƒã‚³ãƒ©"},
        {cat: "æ´‹ã®è‘‰", name: "ã‚¯ãƒ¬ã‚½ãƒ³", count: 6, kw: "ã‚¯ãƒ¬ã‚½ãƒ³"},
        {cat: "æ´‹ã®è‘‰", name: "ãƒ™ãƒ“ãƒ¼ãƒªãƒ¼ãƒ•", count: 4, kw: "ãƒ™ãƒ“ãƒ¼ãƒªãƒ¼ãƒ•"},
        {cat: "ãƒãƒ¼ãƒ–ãƒ»è–¬è‰", name: "ãƒ‘ã‚¯ãƒãƒ¼", count: 4, kw: "ãƒ‘ã‚¯ãƒãƒ¼"},
        {cat: "ãƒãƒ¼ãƒ–ãƒ»è–¬è‰", name: "ãƒ‘ã‚»ãƒª", count: 3, kw: "ãƒ‘ã‚»ãƒª"},
        {cat: "ãƒãƒ¼ãƒ–ãƒ»è–¬è‰", name: "ãƒã‚¸ãƒ«", count: 2, kw: "ãƒã‚¸ãƒ«"},
        {cat: "é‡è‰ãƒ»å±±èœ", name: "æ˜æ—¥è‘‰", count: 10, kw: "æ˜æ—¥è‘‰"},
        {cat: "é‡è‰ãƒ»å±±èœ", name: "ãµãã®ã¨ã†", count: 6, kw: "ãµãã®ã¨ã†"},
        {cat: "é‡è‰ãƒ»å±±èœ", name: "ãƒ¨ãƒ¢ã‚®", count: 5, kw: "ãƒ¨ãƒ¢ã‚®"}
    ];

    // --- æ–™ç†ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ ---
    const dishMaster = [
        {cat: "ç”Ÿãƒ»ã‚µãƒ©ãƒ€", name: "ã‚·ãƒ¼ã‚¶ãƒ¼ã‚µãƒ©ãƒ€", count: 4, kw: "ã‚·ãƒ¼ã‚¶ãƒ¼ã‚µãƒ©ãƒ€"},
        {cat: "ç”Ÿãƒ»ã‚µãƒ©ãƒ€", name: "ã‚³ãƒ¼ãƒ«ã‚¹ãƒ­ãƒ¼", count: 3, kw: "ã‚³ãƒ¼ãƒ«ã‚¹ãƒ­ãƒ¼"},
        {cat: "ç„¼ãƒ»ç‚’", name: "ãŠå¥½ã¿ç„¼ã", count: 5, kw: "ãŠå¥½ã¿ç„¼ã"},
        {cat: "ç„¼ãƒ»ç‚’", name: "é‡èœç‚’ã‚", count: 6, kw: "é‡èœç‚’ã‚"},
        {cat: "ç„¼ãƒ»ç‚’", name: "ç©ºèŠ¯èœç‚’ã‚", count: 7, kw: "ç©ºèŠ¯èœ"},
        {cat: "ç…®ãƒ»è’¸", name: "ãƒ­ãƒ¼ãƒ«ã‚­ãƒ£ãƒ™ãƒ„", count: 5, kw: "ãƒ­ãƒ¼ãƒ«ã‚­ãƒ£ãƒ™ãƒ„"},
        {cat: "ç…®ãƒ»è’¸", name: "ã—ã‚ƒã¶ã—ã‚ƒã¶ãƒ»é‹", count: 8, kw: "é‹+é‡èœ"},
        {cat: "é£²ãƒ»æ±", name: "é’æ±", count: 10, kw: "é’æ±"},
        {cat: "é£²ãƒ»æ±", name: "ã‚°ãƒªãƒ¼ãƒ³ã‚¹ãƒ ãƒ¼ã‚¸ãƒ¼", count: 7, kw: "ã‚¹ãƒ ãƒ¼ã‚¸ãƒ¼"}
    ];

    const bookData = [
        {id: 1, threshold: 10, title: "ç·‘ã®å°‘å¹´ã®è¨˜éŒ²", desc: "ã‚­ãƒ£ãƒ™ãƒ„ã‹ã‚‰ç”Ÿã¾ã‚ŒãŸå°‘å¹´ã®ç‰©èªã€‚", color: "#e91e63", kw: "æ˜”è©±+æœ¬"},
        {id: 2, threshold: 50, title: "å…‰ã‚’ç¯ã™å‘ªæ–‡", desc: "å…‰åˆæˆã‚’ä¿ƒé€²ã™ã‚‹ç¦æ–­ã®æ›¸ã€‚", color: "#9c27b0", kw: "æ¤ç‰©+é­”æ³•"},
        {id: 3, threshold: 150, title: "ãƒŠã‚¤ãƒ«ã®åº­åœ’", desc: "å¤ä»£ã‹ã‚‰æ„›ã•ã‚ŒãŸè‘‰ç‰©ã®æ­´å²ã€‚", color: "#795548", kw: "ã‚¨ã‚¸ãƒ—ãƒˆ+æ­´å²"},
        {id: 4, threshold: 400, title: "ç¿¡ç¿ ã®æ£®ã®å¸æ›¸", desc: "ä¼èª¬ã®å¸æ›¸ãŒæ®‹ã—ãŸç©¶æ¥µã®å›³é‘‘ã€‚", color: "#00695c", kw: "ä¼èª¬+ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼"}
    ];

    function switchMode(mode) {
        currentMode = mode;
        document.getElementById('mode-veg').classList.toggle('active', mode === 'veg');
        document.getElementById('mode-dish').classList.toggle('active', mode === 'dish');
        document.getElementById('veg-ui').style.display = (mode === 'veg') ? 'block' : 'none';
        document.getElementById('dish-ui').style.display = (mode === 'dish') ? 'block' : 'none';
        if(mode === 'veg') updateVegList(); else updateDishList();
    }

    function updateVegList() {
        const cat = document.getElementById('veg-cat').value;
        const list = document.getElementById('veg-list');
        list.innerHTML = "";
        vegMaster.filter(v => v.cat === cat).forEach(v => {
            const opt = document.createElement('option');
            opt.value = v.count; opt.text = `${v.name} (+${v.count}æš)`;
            opt.setAttribute('data-kw', v.kw);
            list.appendChild(opt);
        });
    }

    function updateDishList() {
        const cat = document.getElementById('dish-cat').value;
        const list = document.getElementById('dish-list');
        list.innerHTML = "";
        dishMaster.filter(d => d.cat === cat).forEach(d => {
            const opt = document.createElement('option');
            opt.value = d.count; opt.text = `${d.name} (+${d.count}æš)`;
            opt.setAttribute('data-kw', d.kw);
            list.appendChild(opt);
        });
    }

    function recordLeaf() {
        const selectId = currentMode === 'veg' ? 'veg-list' : 'dish-list';
        const select = document.getElementById(selectId);
        if (!select.value) return;

        const count = parseInt(select.value);
        const name = select.options[select.selectedIndex].text;
        const kw = select.options[select.selectedIndex].getAttribute('data-kw');
        const link = rakutenBase + encodeURIComponent(kw) + "%2F";

        totalLeaves += count;
        document.getElementById('leaf-count').innerText = totalLeaves;

        showPanel(`
            <h3 style="color:var(--dark-green); margin:0;">ğŸŒ¿ ã€Œ${name}ã€ã‚’åè”µï¼</h3>
            <p>ç¾åœ¨ã®ç·è‘‰ã£ã±æ•°: ${totalLeaves}æš</p>
            <div class="affiliate-box">
                <a href="${link}" class="affiliate-link" target="_blank">ã€æ¥½å¤©ã€‘${kw} ã‚’ã‚‚ã£ã¨çŸ¥ã‚‹ â”</a>
            </div>
        `, `Leafy Libraryã«æ–°ç€ï¼ã€Œ${name}ã€ã‚’è¨˜éŒ²ã—ã¾ã—ãŸã€‚ #necotastudio #è‘‰ç‰©é‡èœ`);

        checkUnlock();
    }

    function checkUnlock() {
        bookData.forEach(book => {
            if (totalLeaves >= book.threshold && !unlockedIds.has(book.id)) {
                unlockedIds.add(book.id);
                const shelf = document.getElementById('shelf');
                const b = document.createElement('div');
                b.className = 'book'; b.style.backgroundColor = book.color;
                b.onclick = () => {
                    const link = rakutenBase + encodeURIComponent(book.kw) + "%2F";
                    showPanel(`<h3>ğŸ“–ã€${book.title}ã€</h3><p>${book.desc}</p><div class="affiliate-box"><a href="${link}" class="affiliate-link" target="_blank">è”µæ›¸ã‚’æ¤œç´¢ â”</a></div>`, `æ–°åˆŠã€${book.title}ã€ã‚’ã‚¢ãƒ³ãƒ­ãƒƒã‚¯ï¼ #necotastudio`);
                };
                shelf.appendChild(b);
            }
        });
    }

    function showPanel(html, shareText) {
        document.getElementById('panel-content').innerHTML = html;
        document.getElementById('display-panel').style.display = 'block';
        document.getElementById('share-x').href = `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}&url=${encodeURIComponent(window.location.href)}`;
    }

    updateVegList();
</script>
</body>
</html>
